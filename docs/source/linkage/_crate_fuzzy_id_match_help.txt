usage: crate_fuzzy_id_match [-h] [--version] [--allhelp]
                            {print_demo_sample,hash,compare_plaintext,compare_hashed_to_hashed,compare_hashed_to_plaintext,show_metaphone,show_forename_freq,show_forename_metaphone_freq,show_surname_freq,show_surname_metaphone_freq,show_dob_freq}
                            ...

Identity matching via hashed fuzzy identifiers

optional arguments:
  -h, --help            show this help message and exit
  --version             show program's version number and exit
  --allhelp             show help for all commands and exit

commands:
  Valid commands are as follows.

  {print_demo_sample,hash,compare_plaintext,compare_hashed_to_hashed,compare_hashed_to_plaintext,show_metaphone,show_forename_freq,show_forename_metaphone_freq,show_surname_freq,show_surname_metaphone_freq,show_dob_freq}
                        Specify one command.
    print_demo_sample   Print a demo sample .CSV file.
    hash                STEP 1 OF DE-IDENTIFIED LINKAGE. Hash an identifiable
                        CSV file into an encrypted one.
    compare_plaintext   IDENTIFIABLE LINKAGE COMMAND. Compare a list of
                        probands against a sample (both in plaintext).
    compare_hashed_to_hashed
                        STEP 2 OF DE-IDENTIFIED LINKAGE (for when you have de-
                        identified both sides in advance). Compare a list of
                        probands against a sample (both hashed).
    compare_hashed_to_plaintext
                        STEP 2 OF DE-IDENTIFIED LINKAGE (for when you have
                        received de-identified data and you want to link to
                        your identifiable data, producing a de-identified
                        result). Compare a list of probands (hashed) against a
                        sample (plaintext).
    show_metaphone      Show metaphones of words
    show_forename_freq  Show frequencies of forenames
    show_forename_metaphone_freq
                        Show frequencies of forename metaphones
    show_surname_freq   Show frequencies of surnames
    show_surname_metaphone_freq
                        Show frequencies of surname metaphones
    show_dob_freq       Show the frequency of any DOB

===============================================================================
Help for command 'print_demo_sample'
===============================================================================
usage: crate_fuzzy_id_match print_demo_sample [-h] [--verbose] [--key KEY]
                                              [--allow_default_hash_key]
                                              [--rounding_sf ROUNDING_SF]
                                              [--forename_sex_freq_csv FORENAME_SEX_FREQ_CSV]
                                              [--forename_cache_filename FORENAME_CACHE_FILENAME]
                                              [--surname_freq_csv SURNAME_FREQ_CSV]
                                              [--surname_cache_filename SURNAME_CACHE_FILENAME]
                                              [--name_min_frequency NAME_MIN_FREQUENCY]
                                              [--p_middle_name_n_present P_MIDDLE_NAME_N_PRESENT]
                                              [--population_size POPULATION_SIZE]
                                              [--birth_year_pseudo_range BIRTH_YEAR_PSEUDO_RANGE]
                                              [--postcode_csv_filename POSTCODE_CSV_FILENAME]
                                              [--postcode_cache_filename POSTCODE_CACHE_FILENAME]
                                              [--mean_oa_population MEAN_OA_POPULATION]
                                              [--p_not_male_or_female P_NOT_MALE_OR_FEMALE]
                                              [--p_female_given_male_or_female P_FEMALE_GIVEN_MALE_OR_FEMALE]
                                              [--p_minor_forename_error P_MINOR_FORENAME_ERROR]
                                              [--p_minor_surname_error P_MINOR_SURNAME_ERROR]
                                              [--p_proband_middle_name_missing P_PROBAND_MIDDLE_NAME_MISSING]
                                              [--p_sample_middle_name_missing P_SAMPLE_MIDDLE_NAME_MISSING]
                                              [--p_minor_postcode_error P_MINOR_POSTCODE_ERROR]
                                              [--p_gender_error P_GENDER_ERROR]
                                              [--min_log_odds_for_match MIN_LOG_ODDS_FOR_MATCH]
                                              [--exceeds_next_best_log_odds EXCEEDS_NEXT_BEST_LOG_ODDS]

optional arguments:
  -h, --help            show this help message and exit

display options:
  --verbose             Be verbose

hasher (secrecy) options:
  --key KEY             Key (passphrase) for hasher
  --allow_default_hash_key
                        Allow the default hash key to be used beyond tests.
                        INADVISABLE!
  --rounding_sf ROUNDING_SF
                        Number of significant figures to use when rounding
                        frequencies in hashed version

frequency information for prior probabilities:
  --forename_sex_freq_csv FORENAME_SEX_FREQ_CSV
                        CSV file of "name, sex, frequency" pairs for
                        forenames. You can generate one via
                        crate_fetch_wordlists.
  --forename_cache_filename FORENAME_CACHE_FILENAME
                        File in which to store cached forename info (to speed
                        loading)
  --surname_freq_csv SURNAME_FREQ_CSV
                        CSV file of "name, frequency" pairs for forenames. You
                        can generate one via crate_fetch_wordlists.
  --surname_cache_filename SURNAME_CACHE_FILENAME
                        File in which to store cached surname info (to speed
                        loading)
  --name_min_frequency NAME_MIN_FREQUENCY
                        Minimum base frequency for names. If a frequency is
                        less than this, use this minimum. Allowing extremely
                        low frequencies may increase the chances of a spurious
                        match. Note also that typical name frequency tables
                        don't give very-low-frequency information. For
                        example, for US census forename/surname information,
                        below 0.001 percent they report 0.000 percent; so a
                        reasonable minimum is 0.0005 percent or 0.000005 or
                        5e-6.
  --p_middle_name_n_present P_MIDDLE_NAME_N_PRESENT
                        CSV list of probabilities that a randomly selected
                        person has a certain number of middle names. The first
                        number is P(has a first middle name). The second
                        number is P(has a second middle name | has a first
                        middle name), and so on. The last number present will
                        be re-used ad infinitum if someone has more names.
  --population_size POPULATION_SIZE
                        Size of the whole population, from which we calculate
                        the baseline log odds that two people, randomly
                        selected (and replaced) from the population are the
                        same person.
  --birth_year_pseudo_range BIRTH_YEAR_PSEUDO_RANGE
                        Birth year pseudo-range. The sole purpose is to
                        calculate the probability of two random people sharing
                        a DOB, which is taken as 1/(365.25 * b). This option
                        is b.
  --postcode_csv_filename POSTCODE_CSV_FILENAME
                        CSV file of postcode geography from UK Census/ONS
                        data. A ZIP file is also acceptable.
  --postcode_cache_filename POSTCODE_CACHE_FILENAME
                        File in which to store cached postcodes (to speed
                        loading)
  --mean_oa_population MEAN_OA_POPULATION
                        Mean population of a UK Census Output Area, from which
                        we estimate the population of postcode-based units.
  --p_not_male_or_female P_NOT_MALE_OR_FEMALE
                        Probability that a person in the population has gender
                        'X'.
  --p_female_given_male_or_female P_FEMALE_GIVEN_MALE_OR_FEMALE
                        Probability that a person in the population is female,
                        given that they are either male or female.

error probabilities:
  --p_minor_forename_error P_MINOR_FORENAME_ERROR
                        Assumed probability that a forename has an error in
                        that means it fails a full match but satisfies a
                        partial (metaphone) match.
  --p_minor_surname_error P_MINOR_SURNAME_ERROR
                        Assumed probability that a surname has an error in
                        that means it fails a full match but satisfies a
                        partial (metaphone) match.
  --p_proband_middle_name_missing P_PROBAND_MIDDLE_NAME_MISSING
                        Probability that a middle name, present in the sample,
                        is missing from the proband.
  --p_sample_middle_name_missing P_SAMPLE_MIDDLE_NAME_MISSING
                        Probability that a middle name, present in the
                        proband, is missing from the sample.
  --p_minor_postcode_error P_MINOR_POSTCODE_ERROR
                        Assumed probability that a postcode has an error in
                        that means it fails a full (postcode unit) match but
                        satisfies a partial (postcode sector) match.
  --p_gender_error P_GENDER_ERROR
                        Assumed probability that a gender is wrong leading to
                        a proband/candidate mismatch.

matching rules:
  --min_log_odds_for_match MIN_LOG_ODDS_FOR_MATCH
                        Minimum natural log (ln) odds of two people being the
                        same, before a match will be considered. (Default is
                        equivalent to p = 0.999.)
  --exceeds_next_best_log_odds EXCEEDS_NEXT_BEST_LOG_ODDS
                        Minimum log (ln) odds by which a best match must
                        exceed the next-best match to be considered a unique
                        match.

===============================================================================
Help for command 'hash'
===============================================================================
usage: crate_fuzzy_id_match hash [-h] [--verbose] [--key KEY]
                                 [--allow_default_hash_key]
                                 [--rounding_sf ROUNDING_SF]
                                 [--forename_sex_freq_csv FORENAME_SEX_FREQ_CSV]
                                 [--forename_cache_filename FORENAME_CACHE_FILENAME]
                                 [--surname_freq_csv SURNAME_FREQ_CSV]
                                 [--surname_cache_filename SURNAME_CACHE_FILENAME]
                                 [--name_min_frequency NAME_MIN_FREQUENCY]
                                 [--p_middle_name_n_present P_MIDDLE_NAME_N_PRESENT]
                                 [--population_size POPULATION_SIZE]
                                 [--birth_year_pseudo_range BIRTH_YEAR_PSEUDO_RANGE]
                                 [--postcode_csv_filename POSTCODE_CSV_FILENAME]
                                 [--postcode_cache_filename POSTCODE_CACHE_FILENAME]
                                 [--mean_oa_population MEAN_OA_POPULATION]
                                 [--p_not_male_or_female P_NOT_MALE_OR_FEMALE]
                                 [--p_female_given_male_or_female P_FEMALE_GIVEN_MALE_OR_FEMALE]
                                 [--p_minor_forename_error P_MINOR_FORENAME_ERROR]
                                 [--p_minor_surname_error P_MINOR_SURNAME_ERROR]
                                 [--p_proband_middle_name_missing P_PROBAND_MIDDLE_NAME_MISSING]
                                 [--p_sample_middle_name_missing P_SAMPLE_MIDDLE_NAME_MISSING]
                                 [--p_minor_postcode_error P_MINOR_POSTCODE_ERROR]
                                 [--p_gender_error P_GENDER_ERROR]
                                 [--min_log_odds_for_match MIN_LOG_ODDS_FOR_MATCH]
                                 [--exceeds_next_best_log_odds EXCEEDS_NEXT_BEST_LOG_ODDS]
                                 --input INPUT --output OUTPUT
                                 [--without_frequencies]
                                 [--include_other_info]

    Takes an identifiable list of people (with name, DOB, and postcode
    information) and creates a hashed, de-identified equivalent.

    The local ID (presumed not to be a direct identifier) is preserved exactly.

    Optionally, the "other" information (you can choose, e.g. attaching a
    direct identifier) is preserved, but you have to ask for that explicitly;
    that is normally for testing.

optional arguments:
  -h, --help            show this help message and exit
  --input INPUT         CSV filename for input (plaintext) data. Header row
                        present. Columns: ['local_id', 'first_name',
                        'middle_names', 'surname', 'dob', 'gender',
                        'postcodes', 'other_info']. The fields ['postcodes']
                        are in TemporalIdentifier format. TemporalIdentifier
                        format: IDENTIFIER/STARTDATE/ENDDATE, where dates are
                        in YYYY-MM-DD format or one of ['none', 'null', '?']
                        (case-insensitive). Semicolon-separated values are
                        allowed within ['middle_names', 'postcodes'].
                        (default: None)
  --output OUTPUT       Output CSV file for hashed version. Header row
                        present. Columns: ['local_id', 'hashed_first_name',
                        'first_name_frequency', 'hashed_first_name_metaphone',
                        'first_name_metaphone_frequency',
                        'hashed_middle_names', 'middle_name_frequencies',
                        'hashed_middle_name_metaphones',
                        'middle_name_metaphone_frequencies', 'hashed_surname',
                        'surname_frequency', 'hashed_surname_metaphone',
                        'surname_metaphone_frequency', 'hashed_dob',
                        'hashed_gender', 'gender_frequency',
                        'hashed_postcode_units', 'postcode_unit_frequencies',
                        'hashed_postcode_sectors',
                        'postcode_sector_frequencies', 'other_info']. The
                        fields ['hashed_postcode_sectors',
                        'hashed_postcode_units'] are in TemporalIdentifier
                        format. TemporalIdentifier format:
                        IDENTIFIER/STARTDATE/ENDDATE, where dates are in YYYY-
                        MM-DD format or one of ['none', 'null', '?'] (case-
                        insensitive). Semicolon-separated values are allowed
                        within ['hashed_middle_name_metaphones',
                        'hashed_middle_names', 'hashed_postcode_sectors',
                        'hashed_postcode_units', 'middle_name_frequencies',
                        'middle_name_metaphone_frequencies',
                        'postcode_sector_frequencies',
                        'postcode_unit_frequencies']. (default: None)
  --without_frequencies
                        Do not include frequency information. This makes the
                        result suitable for use as a sample file, but not a
                        proband file. (default: False)
  --include_other_info  Include the (potentially identifying) 'other_info'
                        data? Usually False; may be set to True for
                        validation. (default: False)

display options:
  --verbose             Be verbose (default: False)

hasher (secrecy) options:
  --key KEY             Key (passphrase) for hasher (default: fuzzy_id_match_d
                        efault_hash_key_DO_NOT_USE_FOR_LIVE_DATA)
  --allow_default_hash_key
                        Allow the default hash key to be used beyond tests.
                        INADVISABLE! (default: False)
  --rounding_sf ROUNDING_SF
                        Number of significant figures to use when rounding
                        frequencies in hashed version (default: 5)

frequency information for prior probabilities:
  --forename_sex_freq_csv FORENAME_SEX_FREQ_CSV
                        CSV file of "name, sex, frequency" pairs for
                        forenames. You can generate one via
                        crate_fetch_wordlists. (default: /home/rudolf/Document
                        s/code/crate/crate_anon/linkage/data/us_forename_sex_f
                        req.zip)
  --forename_cache_filename FORENAME_CACHE_FILENAME
                        File in which to store cached forename info (to speed
                        loading) (default:
                        /path/to/crate/user/data/fuzzy_forename_cache.pickle)
  --surname_freq_csv SURNAME_FREQ_CSV
                        CSV file of "name, frequency" pairs for forenames. You
                        can generate one via crate_fetch_wordlists. (default: 
                        /home/rudolf/Documents/code/crate/crate_anon/linkage/d
                        ata/us_surname_freq.zip)
  --surname_cache_filename SURNAME_CACHE_FILENAME
                        File in which to store cached surname info (to speed
                        loading) (default:
                        /path/to/crate/user/data/fuzzy_surname_cache.pickle)
  --name_min_frequency NAME_MIN_FREQUENCY
                        Minimum base frequency for names. If a frequency is
                        less than this, use this minimum. Allowing extremely
                        low frequencies may increase the chances of a spurious
                        match. Note also that typical name frequency tables
                        don't give very-low-frequency information. For
                        example, for US census forename/surname information,
                        below 0.001 percent they report 0.000 percent; so a
                        reasonable minimum is 0.0005 percent or 0.000005 or
                        5e-6. (default: 5e-06)
  --p_middle_name_n_present P_MIDDLE_NAME_N_PRESENT
                        CSV list of probabilities that a randomly selected
                        person has a certain number of middle names. The first
                        number is P(has a first middle name). The second
                        number is P(has a second middle name | has a first
                        middle name), and so on. The last number present will
                        be re-used ad infinitum if someone has more names.
                        (default: 0.8,0.1375)
  --population_size POPULATION_SIZE
                        Size of the whole population, from which we calculate
                        the baseline log odds that two people, randomly
                        selected (and replaced) from the population are the
                        same person. (default: 66040000)
  --birth_year_pseudo_range BIRTH_YEAR_PSEUDO_RANGE
                        Birth year pseudo-range. The sole purpose is to
                        calculate the probability of two random people sharing
                        a DOB, which is taken as 1/(365.25 * b). This option
                        is b. (default: 90)
  --postcode_csv_filename POSTCODE_CSV_FILENAME
                        CSV file of postcode geography from UK Census/ONS
                        data. A ZIP file is also acceptable. (default: /home/r
                        udolf/Documents/code/crate/crate_anon/linkage/data/ONS
                        PD_NOV_2019_UK.zip)
  --postcode_cache_filename POSTCODE_CACHE_FILENAME
                        File in which to store cached postcodes (to speed
                        loading) (default:
                        /path/to/crate/user/data/fuzzy_postcode_cache.pickle)
  --mean_oa_population MEAN_OA_POPULATION
                        Mean population of a UK Census Output Area, from which
                        we estimate the population of postcode-based units.
                        (default: 309)
  --p_not_male_or_female P_NOT_MALE_OR_FEMALE
                        Probability that a person in the population has gender
                        'X'. (default: 0.004)
  --p_female_given_male_or_female P_FEMALE_GIVEN_MALE_OR_FEMALE
                        Probability that a person in the population is female,
                        given that they are either male or female. (default:
                        0.51)

error probabilities:
  --p_minor_forename_error P_MINOR_FORENAME_ERROR
                        Assumed probability that a forename has an error in
                        that means it fails a full match but satisfies a
                        partial (metaphone) match. (default: 0.001)
  --p_minor_surname_error P_MINOR_SURNAME_ERROR
                        Assumed probability that a surname has an error in
                        that means it fails a full match but satisfies a
                        partial (metaphone) match. (default: 0.001)
  --p_proband_middle_name_missing P_PROBAND_MIDDLE_NAME_MISSING
                        Probability that a middle name, present in the sample,
                        is missing from the proband. (default: 0.05)
  --p_sample_middle_name_missing P_SAMPLE_MIDDLE_NAME_MISSING
                        Probability that a middle name, present in the
                        proband, is missing from the sample. (default: 0.05)
  --p_minor_postcode_error P_MINOR_POSTCODE_ERROR
                        Assumed probability that a postcode has an error in
                        that means it fails a full (postcode unit) match but
                        satisfies a partial (postcode sector) match. (default:
                        0.001)
  --p_gender_error P_GENDER_ERROR
                        Assumed probability that a gender is wrong leading to
                        a proband/candidate mismatch. (default: 0.0001)

matching rules:
  --min_log_odds_for_match MIN_LOG_ODDS_FOR_MATCH
                        Minimum natural log (ln) odds of two people being the
                        same, before a match will be considered. (Default is
                        equivalent to p = 0.999.) (default: 6.906754778648553)
  --exceeds_next_best_log_odds EXCEEDS_NEXT_BEST_LOG_ODDS
                        Minimum log (ln) odds by which a best match must
                        exceed the next-best match to be considered a unique
                        match. (default: 10)

===============================================================================
Help for command 'compare_plaintext'
===============================================================================
usage: crate_fuzzy_id_match compare_plaintext [-h] [--verbose] [--key KEY]
                                              [--allow_default_hash_key]
                                              [--rounding_sf ROUNDING_SF]
                                              [--forename_sex_freq_csv FORENAME_SEX_FREQ_CSV]
                                              [--forename_cache_filename FORENAME_CACHE_FILENAME]
                                              [--surname_freq_csv SURNAME_FREQ_CSV]
                                              [--surname_cache_filename SURNAME_CACHE_FILENAME]
                                              [--name_min_frequency NAME_MIN_FREQUENCY]
                                              [--p_middle_name_n_present P_MIDDLE_NAME_N_PRESENT]
                                              [--population_size POPULATION_SIZE]
                                              [--birth_year_pseudo_range BIRTH_YEAR_PSEUDO_RANGE]
                                              [--postcode_csv_filename POSTCODE_CSV_FILENAME]
                                              [--postcode_cache_filename POSTCODE_CACHE_FILENAME]
                                              [--mean_oa_population MEAN_OA_POPULATION]
                                              [--p_not_male_or_female P_NOT_MALE_OR_FEMALE]
                                              [--p_female_given_male_or_female P_FEMALE_GIVEN_MALE_OR_FEMALE]
                                              [--p_minor_forename_error P_MINOR_FORENAME_ERROR]
                                              [--p_minor_surname_error P_MINOR_SURNAME_ERROR]
                                              [--p_proband_middle_name_missing P_PROBAND_MIDDLE_NAME_MISSING]
                                              [--p_sample_middle_name_missing P_SAMPLE_MIDDLE_NAME_MISSING]
                                              [--p_minor_postcode_error P_MINOR_POSTCODE_ERROR]
                                              [--p_gender_error P_GENDER_ERROR]
                                              [--min_log_odds_for_match MIN_LOG_ODDS_FOR_MATCH]
                                              [--exceeds_next_best_log_odds EXCEEDS_NEXT_BEST_LOG_ODDS]
                                              --probands PROBANDS --sample
                                              SAMPLE
                                              [--sample_cache SAMPLE_CACHE]
                                              --output OUTPUT
                                              [--extra_validation_output]
                                              [--n_workers N_WORKERS]
                                              [--max_chunksize MAX_CHUNKSIZE]
                                              [--min_probands_for_parallel MIN_PROBANDS_FOR_PARALLEL]
                                              [--profile]

    Comparison rules:

    - People MUST match on DOB and surname (or surname metaphone), or hashed
      equivalents, to be considered a plausible match.

    - Only plausible matches proceed to the Bayesian comparison.

    The output file is a CSV (comma-separated value) file with a header and
    these columns:

    - proband_local_id
      Local ID (identifiable or de-identified as the user chooses) of the
      proband. Taken from the input.

    - matched
      Boolean. Was a matching person (a "winner") found in the sample, who is
      to be considered a match to the proband? To give a match requires (a)
      that the log odds for the winner reaches a threshold, and (b) that the
      log odds for the winner exceeds the log odds for the runner-up by a
      certain amount (because a mismatch may be worse than a failed match).

    - log_odds_match
      Log (ln) odds that the winner in the sample is a match to the proband.

    - p_match
      Probability that the winner in the sample is a match.

    - sample_match_local_id
      Original local ID of the "winner" in the sample (the candidate who is the
      closest match to the proband).

    - second_best_log_odds
      Log odds of the runner up (the candidate from the sample who is the
      second-closest match) being the same person as the proband.

    If '--extra_validation_output' is used, the following columns are
    added:

    - best_candidate_local_id
      Local ID of the closest-matching person (candidate) in the sample, EVEN
      IF THEY DID NOT WIN.

    The results file is NOT necessarily sorted as the input proband file was
    (not sorting improves parallel processing efficiency).

optional arguments:
  -h, --help            show this help message and exit
  --probands PROBANDS   CSV filename for probands data. Header row present.
                        Columns: ['local_id', 'first_name', 'middle_names',
                        'surname', 'dob', 'gender', 'postcodes',
                        'other_info']. The fields ['postcodes'] are in
                        TemporalIdentifier format. TemporalIdentifier format:
                        IDENTIFIER/STARTDATE/ENDDATE, where dates are in YYYY-
                        MM-DD format or one of ['none', 'null', '?'] (case-
                        insensitive). Semicolon-separated values are allowed
                        within ['middle_names', 'postcodes']. (default: None)
  --sample SAMPLE       CSV filename for sample data. Header row present.
                        Columns: ['local_id', 'first_name', 'middle_names',
                        'surname', 'dob', 'gender', 'postcodes',
                        'other_info']. The fields ['postcodes'] are in
                        TemporalIdentifier format. TemporalIdentifier format:
                        IDENTIFIER/STARTDATE/ENDDATE, where dates are in YYYY-
                        MM-DD format or one of ['none', 'null', '?'] (case-
                        insensitive). Semicolon-separated values are allowed
                        within ['middle_names', 'postcodes']. (default: None)
  --sample_cache SAMPLE_CACHE
                        File in which to store cached sample info (to speed
                        loading) (default: None)
  --output OUTPUT       Output CSV file for proband/sample comparison.
                        (default: None)
  --extra_validation_output
                        Add extra output for validation purposes. (default:
                        False)
  --n_workers N_WORKERS
                        Number of processes to use in parallel. Defaults to
                        number of CPUs on your system. (default: 8)
  --max_chunksize MAX_CHUNKSIZE
                        Maximum chunk size (number of probands to pass to a
                        subprocess each time). (default: 500)
  --min_probands_for_parallel MIN_PROBANDS_FOR_PARALLEL
                        Minimum number of probands for which we will bother to
                        use parallel processing. (default: 100)
  --profile             Profile the code (for development only). (default:
                        False)

display options:
  --verbose             Be verbose (default: False)

hasher (secrecy) options:
  --key KEY             Key (passphrase) for hasher (default: fuzzy_id_match_d
                        efault_hash_key_DO_NOT_USE_FOR_LIVE_DATA)
  --allow_default_hash_key
                        Allow the default hash key to be used beyond tests.
                        INADVISABLE! (default: False)
  --rounding_sf ROUNDING_SF
                        Number of significant figures to use when rounding
                        frequencies in hashed version (default: 5)

frequency information for prior probabilities:
  --forename_sex_freq_csv FORENAME_SEX_FREQ_CSV
                        CSV file of "name, sex, frequency" pairs for
                        forenames. You can generate one via
                        crate_fetch_wordlists. (default: /home/rudolf/Document
                        s/code/crate/crate_anon/linkage/data/us_forename_sex_f
                        req.zip)
  --forename_cache_filename FORENAME_CACHE_FILENAME
                        File in which to store cached forename info (to speed
                        loading) (default:
                        /path/to/crate/user/data/fuzzy_forename_cache.pickle)
  --surname_freq_csv SURNAME_FREQ_CSV
                        CSV file of "name, frequency" pairs for forenames. You
                        can generate one via crate_fetch_wordlists. (default: 
                        /home/rudolf/Documents/code/crate/crate_anon/linkage/d
                        ata/us_surname_freq.zip)
  --surname_cache_filename SURNAME_CACHE_FILENAME
                        File in which to store cached surname info (to speed
                        loading) (default:
                        /path/to/crate/user/data/fuzzy_surname_cache.pickle)
  --name_min_frequency NAME_MIN_FREQUENCY
                        Minimum base frequency for names. If a frequency is
                        less than this, use this minimum. Allowing extremely
                        low frequencies may increase the chances of a spurious
                        match. Note also that typical name frequency tables
                        don't give very-low-frequency information. For
                        example, for US census forename/surname information,
                        below 0.001 percent they report 0.000 percent; so a
                        reasonable minimum is 0.0005 percent or 0.000005 or
                        5e-6. (default: 5e-06)
  --p_middle_name_n_present P_MIDDLE_NAME_N_PRESENT
                        CSV list of probabilities that a randomly selected
                        person has a certain number of middle names. The first
                        number is P(has a first middle name). The second
                        number is P(has a second middle name | has a first
                        middle name), and so on. The last number present will
                        be re-used ad infinitum if someone has more names.
                        (default: 0.8,0.1375)
  --population_size POPULATION_SIZE
                        Size of the whole population, from which we calculate
                        the baseline log odds that two people, randomly
                        selected (and replaced) from the population are the
                        same person. (default: 66040000)
  --birth_year_pseudo_range BIRTH_YEAR_PSEUDO_RANGE
                        Birth year pseudo-range. The sole purpose is to
                        calculate the probability of two random people sharing
                        a DOB, which is taken as 1/(365.25 * b). This option
                        is b. (default: 90)
  --postcode_csv_filename POSTCODE_CSV_FILENAME
                        CSV file of postcode geography from UK Census/ONS
                        data. A ZIP file is also acceptable. (default: /home/r
                        udolf/Documents/code/crate/crate_anon/linkage/data/ONS
                        PD_NOV_2019_UK.zip)
  --postcode_cache_filename POSTCODE_CACHE_FILENAME
                        File in which to store cached postcodes (to speed
                        loading) (default:
                        /path/to/crate/user/data/fuzzy_postcode_cache.pickle)
  --mean_oa_population MEAN_OA_POPULATION
                        Mean population of a UK Census Output Area, from which
                        we estimate the population of postcode-based units.
                        (default: 309)
  --p_not_male_or_female P_NOT_MALE_OR_FEMALE
                        Probability that a person in the population has gender
                        'X'. (default: 0.004)
  --p_female_given_male_or_female P_FEMALE_GIVEN_MALE_OR_FEMALE
                        Probability that a person in the population is female,
                        given that they are either male or female. (default:
                        0.51)

error probabilities:
  --p_minor_forename_error P_MINOR_FORENAME_ERROR
                        Assumed probability that a forename has an error in
                        that means it fails a full match but satisfies a
                        partial (metaphone) match. (default: 0.001)
  --p_minor_surname_error P_MINOR_SURNAME_ERROR
                        Assumed probability that a surname has an error in
                        that means it fails a full match but satisfies a
                        partial (metaphone) match. (default: 0.001)
  --p_proband_middle_name_missing P_PROBAND_MIDDLE_NAME_MISSING
                        Probability that a middle name, present in the sample,
                        is missing from the proband. (default: 0.05)
  --p_sample_middle_name_missing P_SAMPLE_MIDDLE_NAME_MISSING
                        Probability that a middle name, present in the
                        proband, is missing from the sample. (default: 0.05)
  --p_minor_postcode_error P_MINOR_POSTCODE_ERROR
                        Assumed probability that a postcode has an error in
                        that means it fails a full (postcode unit) match but
                        satisfies a partial (postcode sector) match. (default:
                        0.001)
  --p_gender_error P_GENDER_ERROR
                        Assumed probability that a gender is wrong leading to
                        a proband/candidate mismatch. (default: 0.0001)

matching rules:
  --min_log_odds_for_match MIN_LOG_ODDS_FOR_MATCH
                        Minimum natural log (ln) odds of two people being the
                        same, before a match will be considered. (Default is
                        equivalent to p = 0.999.) (default: 6.906754778648553)
  --exceeds_next_best_log_odds EXCEEDS_NEXT_BEST_LOG_ODDS
                        Minimum log (ln) odds by which a best match must
                        exceed the next-best match to be considered a unique
                        match. (default: 10)

===============================================================================
Help for command 'compare_hashed_to_hashed'
===============================================================================
usage: crate_fuzzy_id_match compare_hashed_to_hashed [-h] [--verbose]
                                                     [--key KEY]
                                                     [--allow_default_hash_key]
                                                     [--rounding_sf ROUNDING_SF]
                                                     [--forename_sex_freq_csv FORENAME_SEX_FREQ_CSV]
                                                     [--forename_cache_filename FORENAME_CACHE_FILENAME]
                                                     [--surname_freq_csv SURNAME_FREQ_CSV]
                                                     [--surname_cache_filename SURNAME_CACHE_FILENAME]
                                                     [--name_min_frequency NAME_MIN_FREQUENCY]
                                                     [--p_middle_name_n_present P_MIDDLE_NAME_N_PRESENT]
                                                     [--population_size POPULATION_SIZE]
                                                     [--birth_year_pseudo_range BIRTH_YEAR_PSEUDO_RANGE]
                                                     [--postcode_csv_filename POSTCODE_CSV_FILENAME]
                                                     [--postcode_cache_filename POSTCODE_CACHE_FILENAME]
                                                     [--mean_oa_population MEAN_OA_POPULATION]
                                                     [--p_not_male_or_female P_NOT_MALE_OR_FEMALE]
                                                     [--p_female_given_male_or_female P_FEMALE_GIVEN_MALE_OR_FEMALE]
                                                     [--p_minor_forename_error P_MINOR_FORENAME_ERROR]
                                                     [--p_minor_surname_error P_MINOR_SURNAME_ERROR]
                                                     [--p_proband_middle_name_missing P_PROBAND_MIDDLE_NAME_MISSING]
                                                     [--p_sample_middle_name_missing P_SAMPLE_MIDDLE_NAME_MISSING]
                                                     [--p_minor_postcode_error P_MINOR_POSTCODE_ERROR]
                                                     [--p_gender_error P_GENDER_ERROR]
                                                     [--min_log_odds_for_match MIN_LOG_ODDS_FOR_MATCH]
                                                     [--exceeds_next_best_log_odds EXCEEDS_NEXT_BEST_LOG_ODDS]
                                                     --probands PROBANDS
                                                     --sample SAMPLE
                                                     [--sample_cache SAMPLE_CACHE]
                                                     --output OUTPUT
                                                     [--extra_validation_output]
                                                     [--n_workers N_WORKERS]
                                                     [--max_chunksize MAX_CHUNKSIZE]
                                                     [--min_probands_for_parallel MIN_PROBANDS_FOR_PARALLEL]
                                                     [--profile]

    Comparison rules:

    - People MUST match on DOB and surname (or surname metaphone), or hashed
      equivalents, to be considered a plausible match.

    - Only plausible matches proceed to the Bayesian comparison.

    The output file is a CSV (comma-separated value) file with a header and
    these columns:

    - proband_local_id
      Local ID (identifiable or de-identified as the user chooses) of the
      proband. Taken from the input.

    - matched
      Boolean. Was a matching person (a "winner") found in the sample, who is
      to be considered a match to the proband? To give a match requires (a)
      that the log odds for the winner reaches a threshold, and (b) that the
      log odds for the winner exceeds the log odds for the runner-up by a
      certain amount (because a mismatch may be worse than a failed match).

    - log_odds_match
      Log (ln) odds that the winner in the sample is a match to the proband.

    - p_match
      Probability that the winner in the sample is a match.

    - sample_match_local_id
      Original local ID of the "winner" in the sample (the candidate who is the
      closest match to the proband).

    - second_best_log_odds
      Log odds of the runner up (the candidate from the sample who is the
      second-closest match) being the same person as the proband.

    If '--extra_validation_output' is used, the following columns are
    added:

    - best_candidate_local_id
      Local ID of the closest-matching person (candidate) in the sample, EVEN
      IF THEY DID NOT WIN.

    The results file is NOT necessarily sorted as the input proband file was
    (not sorting improves parallel processing efficiency).

optional arguments:
  -h, --help            show this help message and exit
  --probands PROBANDS   CSV filename for probands data. Header row present.
                        Columns: ['local_id', 'hashed_first_name',
                        'first_name_frequency', 'hashed_first_name_metaphone',
                        'first_name_metaphone_frequency',
                        'hashed_middle_names', 'middle_name_frequencies',
                        'hashed_middle_name_metaphones',
                        'middle_name_metaphone_frequencies', 'hashed_surname',
                        'surname_frequency', 'hashed_surname_metaphone',
                        'surname_metaphone_frequency', 'hashed_dob',
                        'hashed_gender', 'gender_frequency',
                        'hashed_postcode_units', 'postcode_unit_frequencies',
                        'hashed_postcode_sectors',
                        'postcode_sector_frequencies', 'other_info']. The
                        fields ['hashed_postcode_sectors',
                        'hashed_postcode_units'] are in TemporalIdentifier
                        format. TemporalIdentifier format:
                        IDENTIFIER/STARTDATE/ENDDATE, where dates are in YYYY-
                        MM-DD format or one of ['none', 'null', '?'] (case-
                        insensitive). Semicolon-separated values are allowed
                        within ['hashed_middle_name_metaphones',
                        'hashed_middle_names', 'hashed_postcode_sectors',
                        'hashed_postcode_units', 'middle_name_frequencies',
                        'middle_name_metaphone_frequencies',
                        'postcode_sector_frequencies',
                        'postcode_unit_frequencies']. (default: None)
  --sample SAMPLE       CSV filename for sample data. Header row present.
                        Columns: ['local_id', 'hashed_first_name',
                        'first_name_frequency', 'hashed_first_name_metaphone',
                        'first_name_metaphone_frequency',
                        'hashed_middle_names', 'middle_name_frequencies',
                        'hashed_middle_name_metaphones',
                        'middle_name_metaphone_frequencies', 'hashed_surname',
                        'surname_frequency', 'hashed_surname_metaphone',
                        'surname_metaphone_frequency', 'hashed_dob',
                        'hashed_gender', 'gender_frequency',
                        'hashed_postcode_units', 'postcode_unit_frequencies',
                        'hashed_postcode_sectors',
                        'postcode_sector_frequencies', 'other_info']. The
                        fields ['hashed_postcode_sectors',
                        'hashed_postcode_units'] are in TemporalIdentifier
                        format. TemporalIdentifier format:
                        IDENTIFIER/STARTDATE/ENDDATE, where dates are in YYYY-
                        MM-DD format or one of ['none', 'null', '?'] (case-
                        insensitive). Semicolon-separated values are allowed
                        within ['hashed_middle_name_metaphones',
                        'hashed_middle_names', 'hashed_postcode_sectors',
                        'hashed_postcode_units', 'middle_name_frequencies',
                        'middle_name_metaphone_frequencies',
                        'postcode_sector_frequencies',
                        'postcode_unit_frequencies']. (default: None)
  --sample_cache SAMPLE_CACHE
                        File in which to store cached sample info (to speed
                        loading) (default: None)
  --output OUTPUT       Output CSV file for proband/sample comparison.
                        (default: None)
  --extra_validation_output
                        Add extra output for validation purposes. (default:
                        False)
  --n_workers N_WORKERS
                        Number of processes to use in parallel. Defaults to
                        number of CPUs on your system. (default: 8)
  --max_chunksize MAX_CHUNKSIZE
                        Maximum chunk size (number of probands to pass to a
                        subprocess each time). (default: 500)
  --min_probands_for_parallel MIN_PROBANDS_FOR_PARALLEL
                        Minimum number of probands for which we will bother to
                        use parallel processing. (default: 100)
  --profile             Profile the code (for development only). (default:
                        False)

display options:
  --verbose             Be verbose (default: False)

hasher (secrecy) options:
  --key KEY             Key (passphrase) for hasher (default: fuzzy_id_match_d
                        efault_hash_key_DO_NOT_USE_FOR_LIVE_DATA)
  --allow_default_hash_key
                        Allow the default hash key to be used beyond tests.
                        INADVISABLE! (default: False)
  --rounding_sf ROUNDING_SF
                        Number of significant figures to use when rounding
                        frequencies in hashed version (default: 5)

frequency information for prior probabilities:
  --forename_sex_freq_csv FORENAME_SEX_FREQ_CSV
                        CSV file of "name, sex, frequency" pairs for
                        forenames. You can generate one via
                        crate_fetch_wordlists. (default: /home/rudolf/Document
                        s/code/crate/crate_anon/linkage/data/us_forename_sex_f
                        req.zip)
  --forename_cache_filename FORENAME_CACHE_FILENAME
                        File in which to store cached forename info (to speed
                        loading) (default:
                        /path/to/crate/user/data/fuzzy_forename_cache.pickle)
  --surname_freq_csv SURNAME_FREQ_CSV
                        CSV file of "name, frequency" pairs for forenames. You
                        can generate one via crate_fetch_wordlists. (default: 
                        /home/rudolf/Documents/code/crate/crate_anon/linkage/d
                        ata/us_surname_freq.zip)
  --surname_cache_filename SURNAME_CACHE_FILENAME
                        File in which to store cached surname info (to speed
                        loading) (default:
                        /path/to/crate/user/data/fuzzy_surname_cache.pickle)
  --name_min_frequency NAME_MIN_FREQUENCY
                        Minimum base frequency for names. If a frequency is
                        less than this, use this minimum. Allowing extremely
                        low frequencies may increase the chances of a spurious
                        match. Note also that typical name frequency tables
                        don't give very-low-frequency information. For
                        example, for US census forename/surname information,
                        below 0.001 percent they report 0.000 percent; so a
                        reasonable minimum is 0.0005 percent or 0.000005 or
                        5e-6. (default: 5e-06)
  --p_middle_name_n_present P_MIDDLE_NAME_N_PRESENT
                        CSV list of probabilities that a randomly selected
                        person has a certain number of middle names. The first
                        number is P(has a first middle name). The second
                        number is P(has a second middle name | has a first
                        middle name), and so on. The last number present will
                        be re-used ad infinitum if someone has more names.
                        (default: 0.8,0.1375)
  --population_size POPULATION_SIZE
                        Size of the whole population, from which we calculate
                        the baseline log odds that two people, randomly
                        selected (and replaced) from the population are the
                        same person. (default: 66040000)
  --birth_year_pseudo_range BIRTH_YEAR_PSEUDO_RANGE
                        Birth year pseudo-range. The sole purpose is to
                        calculate the probability of two random people sharing
                        a DOB, which is taken as 1/(365.25 * b). This option
                        is b. (default: 90)
  --postcode_csv_filename POSTCODE_CSV_FILENAME
                        CSV file of postcode geography from UK Census/ONS
                        data. A ZIP file is also acceptable. (default: /home/r
                        udolf/Documents/code/crate/crate_anon/linkage/data/ONS
                        PD_NOV_2019_UK.zip)
  --postcode_cache_filename POSTCODE_CACHE_FILENAME
                        File in which to store cached postcodes (to speed
                        loading) (default:
                        /path/to/crate/user/data/fuzzy_postcode_cache.pickle)
  --mean_oa_population MEAN_OA_POPULATION
                        Mean population of a UK Census Output Area, from which
                        we estimate the population of postcode-based units.
                        (default: 309)
  --p_not_male_or_female P_NOT_MALE_OR_FEMALE
                        Probability that a person in the population has gender
                        'X'. (default: 0.004)
  --p_female_given_male_or_female P_FEMALE_GIVEN_MALE_OR_FEMALE
                        Probability that a person in the population is female,
                        given that they are either male or female. (default:
                        0.51)

error probabilities:
  --p_minor_forename_error P_MINOR_FORENAME_ERROR
                        Assumed probability that a forename has an error in
                        that means it fails a full match but satisfies a
                        partial (metaphone) match. (default: 0.001)
  --p_minor_surname_error P_MINOR_SURNAME_ERROR
                        Assumed probability that a surname has an error in
                        that means it fails a full match but satisfies a
                        partial (metaphone) match. (default: 0.001)
  --p_proband_middle_name_missing P_PROBAND_MIDDLE_NAME_MISSING
                        Probability that a middle name, present in the sample,
                        is missing from the proband. (default: 0.05)
  --p_sample_middle_name_missing P_SAMPLE_MIDDLE_NAME_MISSING
                        Probability that a middle name, present in the
                        proband, is missing from the sample. (default: 0.05)
  --p_minor_postcode_error P_MINOR_POSTCODE_ERROR
                        Assumed probability that a postcode has an error in
                        that means it fails a full (postcode unit) match but
                        satisfies a partial (postcode sector) match. (default:
                        0.001)
  --p_gender_error P_GENDER_ERROR
                        Assumed probability that a gender is wrong leading to
                        a proband/candidate mismatch. (default: 0.0001)

matching rules:
  --min_log_odds_for_match MIN_LOG_ODDS_FOR_MATCH
                        Minimum natural log (ln) odds of two people being the
                        same, before a match will be considered. (Default is
                        equivalent to p = 0.999.) (default: 6.906754778648553)
  --exceeds_next_best_log_odds EXCEEDS_NEXT_BEST_LOG_ODDS
                        Minimum log (ln) odds by which a best match must
                        exceed the next-best match to be considered a unique
                        match. (default: 10)

===============================================================================
Help for command 'compare_hashed_to_plaintext'
===============================================================================
usage: crate_fuzzy_id_match compare_hashed_to_plaintext [-h] [--verbose]
                                                        [--key KEY]
                                                        [--allow_default_hash_key]
                                                        [--rounding_sf ROUNDING_SF]
                                                        [--forename_sex_freq_csv FORENAME_SEX_FREQ_CSV]
                                                        [--forename_cache_filename FORENAME_CACHE_FILENAME]
                                                        [--surname_freq_csv SURNAME_FREQ_CSV]
                                                        [--surname_cache_filename SURNAME_CACHE_FILENAME]
                                                        [--name_min_frequency NAME_MIN_FREQUENCY]
                                                        [--p_middle_name_n_present P_MIDDLE_NAME_N_PRESENT]
                                                        [--population_size POPULATION_SIZE]
                                                        [--birth_year_pseudo_range BIRTH_YEAR_PSEUDO_RANGE]
                                                        [--postcode_csv_filename POSTCODE_CSV_FILENAME]
                                                        [--postcode_cache_filename POSTCODE_CACHE_FILENAME]
                                                        [--mean_oa_population MEAN_OA_POPULATION]
                                                        [--p_not_male_or_female P_NOT_MALE_OR_FEMALE]
                                                        [--p_female_given_male_or_female P_FEMALE_GIVEN_MALE_OR_FEMALE]
                                                        [--p_minor_forename_error P_MINOR_FORENAME_ERROR]
                                                        [--p_minor_surname_error P_MINOR_SURNAME_ERROR]
                                                        [--p_proband_middle_name_missing P_PROBAND_MIDDLE_NAME_MISSING]
                                                        [--p_sample_middle_name_missing P_SAMPLE_MIDDLE_NAME_MISSING]
                                                        [--p_minor_postcode_error P_MINOR_POSTCODE_ERROR]
                                                        [--p_gender_error P_GENDER_ERROR]
                                                        [--min_log_odds_for_match MIN_LOG_ODDS_FOR_MATCH]
                                                        [--exceeds_next_best_log_odds EXCEEDS_NEXT_BEST_LOG_ODDS]
                                                        --probands PROBANDS
                                                        --sample SAMPLE
                                                        [--sample_cache SAMPLE_CACHE]
                                                        --output OUTPUT
                                                        [--extra_validation_output]
                                                        [--n_workers N_WORKERS]
                                                        [--max_chunksize MAX_CHUNKSIZE]
                                                        [--min_probands_for_parallel MIN_PROBANDS_FOR_PARALLEL]
                                                        [--profile]

    Comparison rules:

    - People MUST match on DOB and surname (or surname metaphone), or hashed
      equivalents, to be considered a plausible match.

    - Only plausible matches proceed to the Bayesian comparison.

    The output file is a CSV (comma-separated value) file with a header and
    these columns:

    - proband_local_id
      Local ID (identifiable or de-identified as the user chooses) of the
      proband. Taken from the input.

    - matched
      Boolean. Was a matching person (a "winner") found in the sample, who is
      to be considered a match to the proband? To give a match requires (a)
      that the log odds for the winner reaches a threshold, and (b) that the
      log odds for the winner exceeds the log odds for the runner-up by a
      certain amount (because a mismatch may be worse than a failed match).

    - log_odds_match
      Log (ln) odds that the winner in the sample is a match to the proband.

    - p_match
      Probability that the winner in the sample is a match.

    - sample_match_local_id
      Original local ID of the "winner" in the sample (the candidate who is the
      closest match to the proband).

    - second_best_log_odds
      Log odds of the runner up (the candidate from the sample who is the
      second-closest match) being the same person as the proband.

    If '--extra_validation_output' is used, the following columns are
    added:

    - best_candidate_local_id
      Local ID of the closest-matching person (candidate) in the sample, EVEN
      IF THEY DID NOT WIN.

    The results file is NOT necessarily sorted as the input proband file was
    (not sorting improves parallel processing efficiency).

optional arguments:
  -h, --help            show this help message and exit
  --probands PROBANDS   CSV filename for probands data. Header row present.
                        Columns: ['local_id', 'hashed_first_name',
                        'first_name_frequency', 'hashed_first_name_metaphone',
                        'first_name_metaphone_frequency',
                        'hashed_middle_names', 'middle_name_frequencies',
                        'hashed_middle_name_metaphones',
                        'middle_name_metaphone_frequencies', 'hashed_surname',
                        'surname_frequency', 'hashed_surname_metaphone',
                        'surname_metaphone_frequency', 'hashed_dob',
                        'hashed_gender', 'gender_frequency',
                        'hashed_postcode_units', 'postcode_unit_frequencies',
                        'hashed_postcode_sectors',
                        'postcode_sector_frequencies', 'other_info']. The
                        fields ['hashed_postcode_sectors',
                        'hashed_postcode_units'] are in TemporalIdentifier
                        format. TemporalIdentifier format:
                        IDENTIFIER/STARTDATE/ENDDATE, where dates are in YYYY-
                        MM-DD format or one of ['none', 'null', '?'] (case-
                        insensitive). Semicolon-separated values are allowed
                        within ['hashed_middle_name_metaphones',
                        'hashed_middle_names', 'hashed_postcode_sectors',
                        'hashed_postcode_units', 'middle_name_frequencies',
                        'middle_name_metaphone_frequencies',
                        'postcode_sector_frequencies',
                        'postcode_unit_frequencies']. (default: None)
  --sample SAMPLE       CSV filename for sample data. Header row present.
                        Columns: ['local_id', 'first_name', 'middle_names',
                        'surname', 'dob', 'gender', 'postcodes',
                        'other_info']. The fields ['postcodes'] are in
                        TemporalIdentifier format. TemporalIdentifier format:
                        IDENTIFIER/STARTDATE/ENDDATE, where dates are in YYYY-
                        MM-DD format or one of ['none', 'null', '?'] (case-
                        insensitive). Semicolon-separated values are allowed
                        within ['middle_names', 'postcodes']. (default: None)
  --sample_cache SAMPLE_CACHE
                        File in which to store cached sample info (to speed
                        loading) (default: None)
  --output OUTPUT       Output CSV file for proband/sample comparison.
                        (default: None)
  --extra_validation_output
                        Add extra output for validation purposes. (default:
                        False)
  --n_workers N_WORKERS
                        Number of processes to use in parallel. Defaults to
                        number of CPUs on your system. (default: 8)
  --max_chunksize MAX_CHUNKSIZE
                        Maximum chunk size (number of probands to pass to a
                        subprocess each time). (default: 500)
  --min_probands_for_parallel MIN_PROBANDS_FOR_PARALLEL
                        Minimum number of probands for which we will bother to
                        use parallel processing. (default: 100)
  --profile             Profile the code (for development only). (default:
                        False)

display options:
  --verbose             Be verbose (default: False)

hasher (secrecy) options:
  --key KEY             Key (passphrase) for hasher (default: fuzzy_id_match_d
                        efault_hash_key_DO_NOT_USE_FOR_LIVE_DATA)
  --allow_default_hash_key
                        Allow the default hash key to be used beyond tests.
                        INADVISABLE! (default: False)
  --rounding_sf ROUNDING_SF
                        Number of significant figures to use when rounding
                        frequencies in hashed version (default: 5)

frequency information for prior probabilities:
  --forename_sex_freq_csv FORENAME_SEX_FREQ_CSV
                        CSV file of "name, sex, frequency" pairs for
                        forenames. You can generate one via
                        crate_fetch_wordlists. (default: /home/rudolf/Document
                        s/code/crate/crate_anon/linkage/data/us_forename_sex_f
                        req.zip)
  --forename_cache_filename FORENAME_CACHE_FILENAME
                        File in which to store cached forename info (to speed
                        loading) (default:
                        /path/to/crate/user/data/fuzzy_forename_cache.pickle)
  --surname_freq_csv SURNAME_FREQ_CSV
                        CSV file of "name, frequency" pairs for forenames. You
                        can generate one via crate_fetch_wordlists. (default: 
                        /home/rudolf/Documents/code/crate/crate_anon/linkage/d
                        ata/us_surname_freq.zip)
  --surname_cache_filename SURNAME_CACHE_FILENAME
                        File in which to store cached surname info (to speed
                        loading) (default:
                        /path/to/crate/user/data/fuzzy_surname_cache.pickle)
  --name_min_frequency NAME_MIN_FREQUENCY
                        Minimum base frequency for names. If a frequency is
                        less than this, use this minimum. Allowing extremely
                        low frequencies may increase the chances of a spurious
                        match. Note also that typical name frequency tables
                        don't give very-low-frequency information. For
                        example, for US census forename/surname information,
                        below 0.001 percent they report 0.000 percent; so a
                        reasonable minimum is 0.0005 percent or 0.000005 or
                        5e-6. (default: 5e-06)
  --p_middle_name_n_present P_MIDDLE_NAME_N_PRESENT
                        CSV list of probabilities that a randomly selected
                        person has a certain number of middle names. The first
                        number is P(has a first middle name). The second
                        number is P(has a second middle name | has a first
                        middle name), and so on. The last number present will
                        be re-used ad infinitum if someone has more names.
                        (default: 0.8,0.1375)
  --population_size POPULATION_SIZE
                        Size of the whole population, from which we calculate
                        the baseline log odds that two people, randomly
                        selected (and replaced) from the population are the
                        same person. (default: 66040000)
  --birth_year_pseudo_range BIRTH_YEAR_PSEUDO_RANGE
                        Birth year pseudo-range. The sole purpose is to
                        calculate the probability of two random people sharing
                        a DOB, which is taken as 1/(365.25 * b). This option
                        is b. (default: 90)
  --postcode_csv_filename POSTCODE_CSV_FILENAME
                        CSV file of postcode geography from UK Census/ONS
                        data. A ZIP file is also acceptable. (default: /home/r
                        udolf/Documents/code/crate/crate_anon/linkage/data/ONS
                        PD_NOV_2019_UK.zip)
  --postcode_cache_filename POSTCODE_CACHE_FILENAME
                        File in which to store cached postcodes (to speed
                        loading) (default:
                        /path/to/crate/user/data/fuzzy_postcode_cache.pickle)
  --mean_oa_population MEAN_OA_POPULATION
                        Mean population of a UK Census Output Area, from which
                        we estimate the population of postcode-based units.
                        (default: 309)
  --p_not_male_or_female P_NOT_MALE_OR_FEMALE
                        Probability that a person in the population has gender
                        'X'. (default: 0.004)
  --p_female_given_male_or_female P_FEMALE_GIVEN_MALE_OR_FEMALE
                        Probability that a person in the population is female,
                        given that they are either male or female. (default:
                        0.51)

error probabilities:
  --p_minor_forename_error P_MINOR_FORENAME_ERROR
                        Assumed probability that a forename has an error in
                        that means it fails a full match but satisfies a
                        partial (metaphone) match. (default: 0.001)
  --p_minor_surname_error P_MINOR_SURNAME_ERROR
                        Assumed probability that a surname has an error in
                        that means it fails a full match but satisfies a
                        partial (metaphone) match. (default: 0.001)
  --p_proband_middle_name_missing P_PROBAND_MIDDLE_NAME_MISSING
                        Probability that a middle name, present in the sample,
                        is missing from the proband. (default: 0.05)
  --p_sample_middle_name_missing P_SAMPLE_MIDDLE_NAME_MISSING
                        Probability that a middle name, present in the
                        proband, is missing from the sample. (default: 0.05)
  --p_minor_postcode_error P_MINOR_POSTCODE_ERROR
                        Assumed probability that a postcode has an error in
                        that means it fails a full (postcode unit) match but
                        satisfies a partial (postcode sector) match. (default:
                        0.001)
  --p_gender_error P_GENDER_ERROR
                        Assumed probability that a gender is wrong leading to
                        a proband/candidate mismatch. (default: 0.0001)

matching rules:
  --min_log_odds_for_match MIN_LOG_ODDS_FOR_MATCH
                        Minimum natural log (ln) odds of two people being the
                        same, before a match will be considered. (Default is
                        equivalent to p = 0.999.) (default: 6.906754778648553)
  --exceeds_next_best_log_odds EXCEEDS_NEXT_BEST_LOG_ODDS
                        Minimum log (ln) odds by which a best match must
                        exceed the next-best match to be considered a unique
                        match. (default: 10)

===============================================================================
Help for command 'show_metaphone'
===============================================================================
usage: crate_fuzzy_id_match show_metaphone [-h] [--verbose] [--key KEY]
                                           [--allow_default_hash_key]
                                           [--rounding_sf ROUNDING_SF]
                                           [--forename_sex_freq_csv FORENAME_SEX_FREQ_CSV]
                                           [--forename_cache_filename FORENAME_CACHE_FILENAME]
                                           [--surname_freq_csv SURNAME_FREQ_CSV]
                                           [--surname_cache_filename SURNAME_CACHE_FILENAME]
                                           [--name_min_frequency NAME_MIN_FREQUENCY]
                                           [--p_middle_name_n_present P_MIDDLE_NAME_N_PRESENT]
                                           [--population_size POPULATION_SIZE]
                                           [--birth_year_pseudo_range BIRTH_YEAR_PSEUDO_RANGE]
                                           [--postcode_csv_filename POSTCODE_CSV_FILENAME]
                                           [--postcode_cache_filename POSTCODE_CACHE_FILENAME]
                                           [--mean_oa_population MEAN_OA_POPULATION]
                                           [--p_not_male_or_female P_NOT_MALE_OR_FEMALE]
                                           [--p_female_given_male_or_female P_FEMALE_GIVEN_MALE_OR_FEMALE]
                                           [--p_minor_forename_error P_MINOR_FORENAME_ERROR]
                                           [--p_minor_surname_error P_MINOR_SURNAME_ERROR]
                                           [--p_proband_middle_name_missing P_PROBAND_MIDDLE_NAME_MISSING]
                                           [--p_sample_middle_name_missing P_SAMPLE_MIDDLE_NAME_MISSING]
                                           [--p_minor_postcode_error P_MINOR_POSTCODE_ERROR]
                                           [--p_gender_error P_GENDER_ERROR]
                                           [--min_log_odds_for_match MIN_LOG_ODDS_FOR_MATCH]
                                           [--exceeds_next_best_log_odds EXCEEDS_NEXT_BEST_LOG_ODDS]
                                           words [words ...]

positional arguments:
  words                 Words to check

optional arguments:
  -h, --help            show this help message and exit

display options:
  --verbose             Be verbose

hasher (secrecy) options:
  --key KEY             Key (passphrase) for hasher
  --allow_default_hash_key
                        Allow the default hash key to be used beyond tests.
                        INADVISABLE!
  --rounding_sf ROUNDING_SF
                        Number of significant figures to use when rounding
                        frequencies in hashed version

frequency information for prior probabilities:
  --forename_sex_freq_csv FORENAME_SEX_FREQ_CSV
                        CSV file of "name, sex, frequency" pairs for
                        forenames. You can generate one via
                        crate_fetch_wordlists.
  --forename_cache_filename FORENAME_CACHE_FILENAME
                        File in which to store cached forename info (to speed
                        loading)
  --surname_freq_csv SURNAME_FREQ_CSV
                        CSV file of "name, frequency" pairs for forenames. You
                        can generate one via crate_fetch_wordlists.
  --surname_cache_filename SURNAME_CACHE_FILENAME
                        File in which to store cached surname info (to speed
                        loading)
  --name_min_frequency NAME_MIN_FREQUENCY
                        Minimum base frequency for names. If a frequency is
                        less than this, use this minimum. Allowing extremely
                        low frequencies may increase the chances of a spurious
                        match. Note also that typical name frequency tables
                        don't give very-low-frequency information. For
                        example, for US census forename/surname information,
                        below 0.001 percent they report 0.000 percent; so a
                        reasonable minimum is 0.0005 percent or 0.000005 or
                        5e-6.
  --p_middle_name_n_present P_MIDDLE_NAME_N_PRESENT
                        CSV list of probabilities that a randomly selected
                        person has a certain number of middle names. The first
                        number is P(has a first middle name). The second
                        number is P(has a second middle name | has a first
                        middle name), and so on. The last number present will
                        be re-used ad infinitum if someone has more names.
  --population_size POPULATION_SIZE
                        Size of the whole population, from which we calculate
                        the baseline log odds that two people, randomly
                        selected (and replaced) from the population are the
                        same person.
  --birth_year_pseudo_range BIRTH_YEAR_PSEUDO_RANGE
                        Birth year pseudo-range. The sole purpose is to
                        calculate the probability of two random people sharing
                        a DOB, which is taken as 1/(365.25 * b). This option
                        is b.
  --postcode_csv_filename POSTCODE_CSV_FILENAME
                        CSV file of postcode geography from UK Census/ONS
                        data. A ZIP file is also acceptable.
  --postcode_cache_filename POSTCODE_CACHE_FILENAME
                        File in which to store cached postcodes (to speed
                        loading)
  --mean_oa_population MEAN_OA_POPULATION
                        Mean population of a UK Census Output Area, from which
                        we estimate the population of postcode-based units.
  --p_not_male_or_female P_NOT_MALE_OR_FEMALE
                        Probability that a person in the population has gender
                        'X'.
  --p_female_given_male_or_female P_FEMALE_GIVEN_MALE_OR_FEMALE
                        Probability that a person in the population is female,
                        given that they are either male or female.

error probabilities:
  --p_minor_forename_error P_MINOR_FORENAME_ERROR
                        Assumed probability that a forename has an error in
                        that means it fails a full match but satisfies a
                        partial (metaphone) match.
  --p_minor_surname_error P_MINOR_SURNAME_ERROR
                        Assumed probability that a surname has an error in
                        that means it fails a full match but satisfies a
                        partial (metaphone) match.
  --p_proband_middle_name_missing P_PROBAND_MIDDLE_NAME_MISSING
                        Probability that a middle name, present in the sample,
                        is missing from the proband.
  --p_sample_middle_name_missing P_SAMPLE_MIDDLE_NAME_MISSING
                        Probability that a middle name, present in the
                        proband, is missing from the sample.
  --p_minor_postcode_error P_MINOR_POSTCODE_ERROR
                        Assumed probability that a postcode has an error in
                        that means it fails a full (postcode unit) match but
                        satisfies a partial (postcode sector) match.
  --p_gender_error P_GENDER_ERROR
                        Assumed probability that a gender is wrong leading to
                        a proband/candidate mismatch.

matching rules:
  --min_log_odds_for_match MIN_LOG_ODDS_FOR_MATCH
                        Minimum natural log (ln) odds of two people being the
                        same, before a match will be considered. (Default is
                        equivalent to p = 0.999.)
  --exceeds_next_best_log_odds EXCEEDS_NEXT_BEST_LOG_ODDS
                        Minimum log (ln) odds by which a best match must
                        exceed the next-best match to be considered a unique
                        match.

===============================================================================
Help for command 'show_forename_freq'
===============================================================================
usage: crate_fuzzy_id_match show_forename_freq [-h] [--verbose] [--key KEY]
                                               [--allow_default_hash_key]
                                               [--rounding_sf ROUNDING_SF]
                                               [--forename_sex_freq_csv FORENAME_SEX_FREQ_CSV]
                                               [--forename_cache_filename FORENAME_CACHE_FILENAME]
                                               [--surname_freq_csv SURNAME_FREQ_CSV]
                                               [--surname_cache_filename SURNAME_CACHE_FILENAME]
                                               [--name_min_frequency NAME_MIN_FREQUENCY]
                                               [--p_middle_name_n_present P_MIDDLE_NAME_N_PRESENT]
                                               [--population_size POPULATION_SIZE]
                                               [--birth_year_pseudo_range BIRTH_YEAR_PSEUDO_RANGE]
                                               [--postcode_csv_filename POSTCODE_CSV_FILENAME]
                                               [--postcode_cache_filename POSTCODE_CACHE_FILENAME]
                                               [--mean_oa_population MEAN_OA_POPULATION]
                                               [--p_not_male_or_female P_NOT_MALE_OR_FEMALE]
                                               [--p_female_given_male_or_female P_FEMALE_GIVEN_MALE_OR_FEMALE]
                                               [--p_minor_forename_error P_MINOR_FORENAME_ERROR]
                                               [--p_minor_surname_error P_MINOR_SURNAME_ERROR]
                                               [--p_proband_middle_name_missing P_PROBAND_MIDDLE_NAME_MISSING]
                                               [--p_sample_middle_name_missing P_SAMPLE_MIDDLE_NAME_MISSING]
                                               [--p_minor_postcode_error P_MINOR_POSTCODE_ERROR]
                                               [--p_gender_error P_GENDER_ERROR]
                                               [--min_log_odds_for_match MIN_LOG_ODDS_FOR_MATCH]
                                               [--exceeds_next_best_log_odds EXCEEDS_NEXT_BEST_LOG_ODDS]
                                               forenames [forenames ...]

positional arguments:
  forenames             Forenames to check

optional arguments:
  -h, --help            show this help message and exit

display options:
  --verbose             Be verbose

hasher (secrecy) options:
  --key KEY             Key (passphrase) for hasher
  --allow_default_hash_key
                        Allow the default hash key to be used beyond tests.
                        INADVISABLE!
  --rounding_sf ROUNDING_SF
                        Number of significant figures to use when rounding
                        frequencies in hashed version

frequency information for prior probabilities:
  --forename_sex_freq_csv FORENAME_SEX_FREQ_CSV
                        CSV file of "name, sex, frequency" pairs for
                        forenames. You can generate one via
                        crate_fetch_wordlists.
  --forename_cache_filename FORENAME_CACHE_FILENAME
                        File in which to store cached forename info (to speed
                        loading)
  --surname_freq_csv SURNAME_FREQ_CSV
                        CSV file of "name, frequency" pairs for forenames. You
                        can generate one via crate_fetch_wordlists.
  --surname_cache_filename SURNAME_CACHE_FILENAME
                        File in which to store cached surname info (to speed
                        loading)
  --name_min_frequency NAME_MIN_FREQUENCY
                        Minimum base frequency for names. If a frequency is
                        less than this, use this minimum. Allowing extremely
                        low frequencies may increase the chances of a spurious
                        match. Note also that typical name frequency tables
                        don't give very-low-frequency information. For
                        example, for US census forename/surname information,
                        below 0.001 percent they report 0.000 percent; so a
                        reasonable minimum is 0.0005 percent or 0.000005 or
                        5e-6.
  --p_middle_name_n_present P_MIDDLE_NAME_N_PRESENT
                        CSV list of probabilities that a randomly selected
                        person has a certain number of middle names. The first
                        number is P(has a first middle name). The second
                        number is P(has a second middle name | has a first
                        middle name), and so on. The last number present will
                        be re-used ad infinitum if someone has more names.
  --population_size POPULATION_SIZE
                        Size of the whole population, from which we calculate
                        the baseline log odds that two people, randomly
                        selected (and replaced) from the population are the
                        same person.
  --birth_year_pseudo_range BIRTH_YEAR_PSEUDO_RANGE
                        Birth year pseudo-range. The sole purpose is to
                        calculate the probability of two random people sharing
                        a DOB, which is taken as 1/(365.25 * b). This option
                        is b.
  --postcode_csv_filename POSTCODE_CSV_FILENAME
                        CSV file of postcode geography from UK Census/ONS
                        data. A ZIP file is also acceptable.
  --postcode_cache_filename POSTCODE_CACHE_FILENAME
                        File in which to store cached postcodes (to speed
                        loading)
  --mean_oa_population MEAN_OA_POPULATION
                        Mean population of a UK Census Output Area, from which
                        we estimate the population of postcode-based units.
  --p_not_male_or_female P_NOT_MALE_OR_FEMALE
                        Probability that a person in the population has gender
                        'X'.
  --p_female_given_male_or_female P_FEMALE_GIVEN_MALE_OR_FEMALE
                        Probability that a person in the population is female,
                        given that they are either male or female.

error probabilities:
  --p_minor_forename_error P_MINOR_FORENAME_ERROR
                        Assumed probability that a forename has an error in
                        that means it fails a full match but satisfies a
                        partial (metaphone) match.
  --p_minor_surname_error P_MINOR_SURNAME_ERROR
                        Assumed probability that a surname has an error in
                        that means it fails a full match but satisfies a
                        partial (metaphone) match.
  --p_proband_middle_name_missing P_PROBAND_MIDDLE_NAME_MISSING
                        Probability that a middle name, present in the sample,
                        is missing from the proband.
  --p_sample_middle_name_missing P_SAMPLE_MIDDLE_NAME_MISSING
                        Probability that a middle name, present in the
                        proband, is missing from the sample.
  --p_minor_postcode_error P_MINOR_POSTCODE_ERROR
                        Assumed probability that a postcode has an error in
                        that means it fails a full (postcode unit) match but
                        satisfies a partial (postcode sector) match.
  --p_gender_error P_GENDER_ERROR
                        Assumed probability that a gender is wrong leading to
                        a proband/candidate mismatch.

matching rules:
  --min_log_odds_for_match MIN_LOG_ODDS_FOR_MATCH
                        Minimum natural log (ln) odds of two people being the
                        same, before a match will be considered. (Default is
                        equivalent to p = 0.999.)
  --exceeds_next_best_log_odds EXCEEDS_NEXT_BEST_LOG_ODDS
                        Minimum log (ln) odds by which a best match must
                        exceed the next-best match to be considered a unique
                        match.

===============================================================================
Help for command 'show_forename_metaphone_freq'
===============================================================================
usage: crate_fuzzy_id_match show_forename_metaphone_freq [-h] [--verbose]
                                                         [--key KEY]
                                                         [--allow_default_hash_key]
                                                         [--rounding_sf ROUNDING_SF]
                                                         [--forename_sex_freq_csv FORENAME_SEX_FREQ_CSV]
                                                         [--forename_cache_filename FORENAME_CACHE_FILENAME]
                                                         [--surname_freq_csv SURNAME_FREQ_CSV]
                                                         [--surname_cache_filename SURNAME_CACHE_FILENAME]
                                                         [--name_min_frequency NAME_MIN_FREQUENCY]
                                                         [--p_middle_name_n_present P_MIDDLE_NAME_N_PRESENT]
                                                         [--population_size POPULATION_SIZE]
                                                         [--birth_year_pseudo_range BIRTH_YEAR_PSEUDO_RANGE]
                                                         [--postcode_csv_filename POSTCODE_CSV_FILENAME]
                                                         [--postcode_cache_filename POSTCODE_CACHE_FILENAME]
                                                         [--mean_oa_population MEAN_OA_POPULATION]
                                                         [--p_not_male_or_female P_NOT_MALE_OR_FEMALE]
                                                         [--p_female_given_male_or_female P_FEMALE_GIVEN_MALE_OR_FEMALE]
                                                         [--p_minor_forename_error P_MINOR_FORENAME_ERROR]
                                                         [--p_minor_surname_error P_MINOR_SURNAME_ERROR]
                                                         [--p_proband_middle_name_missing P_PROBAND_MIDDLE_NAME_MISSING]
                                                         [--p_sample_middle_name_missing P_SAMPLE_MIDDLE_NAME_MISSING]
                                                         [--p_minor_postcode_error P_MINOR_POSTCODE_ERROR]
                                                         [--p_gender_error P_GENDER_ERROR]
                                                         [--min_log_odds_for_match MIN_LOG_ODDS_FOR_MATCH]
                                                         [--exceeds_next_best_log_odds EXCEEDS_NEXT_BEST_LOG_ODDS]
                                                         metaphones
                                                         [metaphones ...]

positional arguments:
  metaphones            Forenames to check

optional arguments:
  -h, --help            show this help message and exit

display options:
  --verbose             Be verbose

hasher (secrecy) options:
  --key KEY             Key (passphrase) for hasher
  --allow_default_hash_key
                        Allow the default hash key to be used beyond tests.
                        INADVISABLE!
  --rounding_sf ROUNDING_SF
                        Number of significant figures to use when rounding
                        frequencies in hashed version

frequency information for prior probabilities:
  --forename_sex_freq_csv FORENAME_SEX_FREQ_CSV
                        CSV file of "name, sex, frequency" pairs for
                        forenames. You can generate one via
                        crate_fetch_wordlists.
  --forename_cache_filename FORENAME_CACHE_FILENAME
                        File in which to store cached forename info (to speed
                        loading)
  --surname_freq_csv SURNAME_FREQ_CSV
                        CSV file of "name, frequency" pairs for forenames. You
                        can generate one via crate_fetch_wordlists.
  --surname_cache_filename SURNAME_CACHE_FILENAME
                        File in which to store cached surname info (to speed
                        loading)
  --name_min_frequency NAME_MIN_FREQUENCY
                        Minimum base frequency for names. If a frequency is
                        less than this, use this minimum. Allowing extremely
                        low frequencies may increase the chances of a spurious
                        match. Note also that typical name frequency tables
                        don't give very-low-frequency information. For
                        example, for US census forename/surname information,
                        below 0.001 percent they report 0.000 percent; so a
                        reasonable minimum is 0.0005 percent or 0.000005 or
                        5e-6.
  --p_middle_name_n_present P_MIDDLE_NAME_N_PRESENT
                        CSV list of probabilities that a randomly selected
                        person has a certain number of middle names. The first
                        number is P(has a first middle name). The second
                        number is P(has a second middle name | has a first
                        middle name), and so on. The last number present will
                        be re-used ad infinitum if someone has more names.
  --population_size POPULATION_SIZE
                        Size of the whole population, from which we calculate
                        the baseline log odds that two people, randomly
                        selected (and replaced) from the population are the
                        same person.
  --birth_year_pseudo_range BIRTH_YEAR_PSEUDO_RANGE
                        Birth year pseudo-range. The sole purpose is to
                        calculate the probability of two random people sharing
                        a DOB, which is taken as 1/(365.25 * b). This option
                        is b.
  --postcode_csv_filename POSTCODE_CSV_FILENAME
                        CSV file of postcode geography from UK Census/ONS
                        data. A ZIP file is also acceptable.
  --postcode_cache_filename POSTCODE_CACHE_FILENAME
                        File in which to store cached postcodes (to speed
                        loading)
  --mean_oa_population MEAN_OA_POPULATION
                        Mean population of a UK Census Output Area, from which
                        we estimate the population of postcode-based units.
  --p_not_male_or_female P_NOT_MALE_OR_FEMALE
                        Probability that a person in the population has gender
                        'X'.
  --p_female_given_male_or_female P_FEMALE_GIVEN_MALE_OR_FEMALE
                        Probability that a person in the population is female,
                        given that they are either male or female.

error probabilities:
  --p_minor_forename_error P_MINOR_FORENAME_ERROR
                        Assumed probability that a forename has an error in
                        that means it fails a full match but satisfies a
                        partial (metaphone) match.
  --p_minor_surname_error P_MINOR_SURNAME_ERROR
                        Assumed probability that a surname has an error in
                        that means it fails a full match but satisfies a
                        partial (metaphone) match.
  --p_proband_middle_name_missing P_PROBAND_MIDDLE_NAME_MISSING
                        Probability that a middle name, present in the sample,
                        is missing from the proband.
  --p_sample_middle_name_missing P_SAMPLE_MIDDLE_NAME_MISSING
                        Probability that a middle name, present in the
                        proband, is missing from the sample.
  --p_minor_postcode_error P_MINOR_POSTCODE_ERROR
                        Assumed probability that a postcode has an error in
                        that means it fails a full (postcode unit) match but
                        satisfies a partial (postcode sector) match.
  --p_gender_error P_GENDER_ERROR
                        Assumed probability that a gender is wrong leading to
                        a proband/candidate mismatch.

matching rules:
  --min_log_odds_for_match MIN_LOG_ODDS_FOR_MATCH
                        Minimum natural log (ln) odds of two people being the
                        same, before a match will be considered. (Default is
                        equivalent to p = 0.999.)
  --exceeds_next_best_log_odds EXCEEDS_NEXT_BEST_LOG_ODDS
                        Minimum log (ln) odds by which a best match must
                        exceed the next-best match to be considered a unique
                        match.

===============================================================================
Help for command 'show_surname_freq'
===============================================================================
usage: crate_fuzzy_id_match show_surname_freq [-h] [--verbose] [--key KEY]
                                              [--allow_default_hash_key]
                                              [--rounding_sf ROUNDING_SF]
                                              [--forename_sex_freq_csv FORENAME_SEX_FREQ_CSV]
                                              [--forename_cache_filename FORENAME_CACHE_FILENAME]
                                              [--surname_freq_csv SURNAME_FREQ_CSV]
                                              [--surname_cache_filename SURNAME_CACHE_FILENAME]
                                              [--name_min_frequency NAME_MIN_FREQUENCY]
                                              [--p_middle_name_n_present P_MIDDLE_NAME_N_PRESENT]
                                              [--population_size POPULATION_SIZE]
                                              [--birth_year_pseudo_range BIRTH_YEAR_PSEUDO_RANGE]
                                              [--postcode_csv_filename POSTCODE_CSV_FILENAME]
                                              [--postcode_cache_filename POSTCODE_CACHE_FILENAME]
                                              [--mean_oa_population MEAN_OA_POPULATION]
                                              [--p_not_male_or_female P_NOT_MALE_OR_FEMALE]
                                              [--p_female_given_male_or_female P_FEMALE_GIVEN_MALE_OR_FEMALE]
                                              [--p_minor_forename_error P_MINOR_FORENAME_ERROR]
                                              [--p_minor_surname_error P_MINOR_SURNAME_ERROR]
                                              [--p_proband_middle_name_missing P_PROBAND_MIDDLE_NAME_MISSING]
                                              [--p_sample_middle_name_missing P_SAMPLE_MIDDLE_NAME_MISSING]
                                              [--p_minor_postcode_error P_MINOR_POSTCODE_ERROR]
                                              [--p_gender_error P_GENDER_ERROR]
                                              [--min_log_odds_for_match MIN_LOG_ODDS_FOR_MATCH]
                                              [--exceeds_next_best_log_odds EXCEEDS_NEXT_BEST_LOG_ODDS]
                                              surnames [surnames ...]

positional arguments:
  surnames              surnames to check

optional arguments:
  -h, --help            show this help message and exit

display options:
  --verbose             Be verbose

hasher (secrecy) options:
  --key KEY             Key (passphrase) for hasher
  --allow_default_hash_key
                        Allow the default hash key to be used beyond tests.
                        INADVISABLE!
  --rounding_sf ROUNDING_SF
                        Number of significant figures to use when rounding
                        frequencies in hashed version

frequency information for prior probabilities:
  --forename_sex_freq_csv FORENAME_SEX_FREQ_CSV
                        CSV file of "name, sex, frequency" pairs for
                        forenames. You can generate one via
                        crate_fetch_wordlists.
  --forename_cache_filename FORENAME_CACHE_FILENAME
                        File in which to store cached forename info (to speed
                        loading)
  --surname_freq_csv SURNAME_FREQ_CSV
                        CSV file of "name, frequency" pairs for forenames. You
                        can generate one via crate_fetch_wordlists.
  --surname_cache_filename SURNAME_CACHE_FILENAME
                        File in which to store cached surname info (to speed
                        loading)
  --name_min_frequency NAME_MIN_FREQUENCY
                        Minimum base frequency for names. If a frequency is
                        less than this, use this minimum. Allowing extremely
                        low frequencies may increase the chances of a spurious
                        match. Note also that typical name frequency tables
                        don't give very-low-frequency information. For
                        example, for US census forename/surname information,
                        below 0.001 percent they report 0.000 percent; so a
                        reasonable minimum is 0.0005 percent or 0.000005 or
                        5e-6.
  --p_middle_name_n_present P_MIDDLE_NAME_N_PRESENT
                        CSV list of probabilities that a randomly selected
                        person has a certain number of middle names. The first
                        number is P(has a first middle name). The second
                        number is P(has a second middle name | has a first
                        middle name), and so on. The last number present will
                        be re-used ad infinitum if someone has more names.
  --population_size POPULATION_SIZE
                        Size of the whole population, from which we calculate
                        the baseline log odds that two people, randomly
                        selected (and replaced) from the population are the
                        same person.
  --birth_year_pseudo_range BIRTH_YEAR_PSEUDO_RANGE
                        Birth year pseudo-range. The sole purpose is to
                        calculate the probability of two random people sharing
                        a DOB, which is taken as 1/(365.25 * b). This option
                        is b.
  --postcode_csv_filename POSTCODE_CSV_FILENAME
                        CSV file of postcode geography from UK Census/ONS
                        data. A ZIP file is also acceptable.
  --postcode_cache_filename POSTCODE_CACHE_FILENAME
                        File in which to store cached postcodes (to speed
                        loading)
  --mean_oa_population MEAN_OA_POPULATION
                        Mean population of a UK Census Output Area, from which
                        we estimate the population of postcode-based units.
  --p_not_male_or_female P_NOT_MALE_OR_FEMALE
                        Probability that a person in the population has gender
                        'X'.
  --p_female_given_male_or_female P_FEMALE_GIVEN_MALE_OR_FEMALE
                        Probability that a person in the population is female,
                        given that they are either male or female.

error probabilities:
  --p_minor_forename_error P_MINOR_FORENAME_ERROR
                        Assumed probability that a forename has an error in
                        that means it fails a full match but satisfies a
                        partial (metaphone) match.
  --p_minor_surname_error P_MINOR_SURNAME_ERROR
                        Assumed probability that a surname has an error in
                        that means it fails a full match but satisfies a
                        partial (metaphone) match.
  --p_proband_middle_name_missing P_PROBAND_MIDDLE_NAME_MISSING
                        Probability that a middle name, present in the sample,
                        is missing from the proband.
  --p_sample_middle_name_missing P_SAMPLE_MIDDLE_NAME_MISSING
                        Probability that a middle name, present in the
                        proband, is missing from the sample.
  --p_minor_postcode_error P_MINOR_POSTCODE_ERROR
                        Assumed probability that a postcode has an error in
                        that means it fails a full (postcode unit) match but
                        satisfies a partial (postcode sector) match.
  --p_gender_error P_GENDER_ERROR
                        Assumed probability that a gender is wrong leading to
                        a proband/candidate mismatch.

matching rules:
  --min_log_odds_for_match MIN_LOG_ODDS_FOR_MATCH
                        Minimum natural log (ln) odds of two people being the
                        same, before a match will be considered. (Default is
                        equivalent to p = 0.999.)
  --exceeds_next_best_log_odds EXCEEDS_NEXT_BEST_LOG_ODDS
                        Minimum log (ln) odds by which a best match must
                        exceed the next-best match to be considered a unique
                        match.

===============================================================================
Help for command 'show_surname_metaphone_freq'
===============================================================================
usage: crate_fuzzy_id_match show_surname_metaphone_freq [-h] [--verbose]
                                                        [--key KEY]
                                                        [--allow_default_hash_key]
                                                        [--rounding_sf ROUNDING_SF]
                                                        [--forename_sex_freq_csv FORENAME_SEX_FREQ_CSV]
                                                        [--forename_cache_filename FORENAME_CACHE_FILENAME]
                                                        [--surname_freq_csv SURNAME_FREQ_CSV]
                                                        [--surname_cache_filename SURNAME_CACHE_FILENAME]
                                                        [--name_min_frequency NAME_MIN_FREQUENCY]
                                                        [--p_middle_name_n_present P_MIDDLE_NAME_N_PRESENT]
                                                        [--population_size POPULATION_SIZE]
                                                        [--birth_year_pseudo_range BIRTH_YEAR_PSEUDO_RANGE]
                                                        [--postcode_csv_filename POSTCODE_CSV_FILENAME]
                                                        [--postcode_cache_filename POSTCODE_CACHE_FILENAME]
                                                        [--mean_oa_population MEAN_OA_POPULATION]
                                                        [--p_not_male_or_female P_NOT_MALE_OR_FEMALE]
                                                        [--p_female_given_male_or_female P_FEMALE_GIVEN_MALE_OR_FEMALE]
                                                        [--p_minor_forename_error P_MINOR_FORENAME_ERROR]
                                                        [--p_minor_surname_error P_MINOR_SURNAME_ERROR]
                                                        [--p_proband_middle_name_missing P_PROBAND_MIDDLE_NAME_MISSING]
                                                        [--p_sample_middle_name_missing P_SAMPLE_MIDDLE_NAME_MISSING]
                                                        [--p_minor_postcode_error P_MINOR_POSTCODE_ERROR]
                                                        [--p_gender_error P_GENDER_ERROR]
                                                        [--min_log_odds_for_match MIN_LOG_ODDS_FOR_MATCH]
                                                        [--exceeds_next_best_log_odds EXCEEDS_NEXT_BEST_LOG_ODDS]
                                                        metaphones
                                                        [metaphones ...]

positional arguments:
  metaphones            surnames to check

optional arguments:
  -h, --help            show this help message and exit

display options:
  --verbose             Be verbose

hasher (secrecy) options:
  --key KEY             Key (passphrase) for hasher
  --allow_default_hash_key
                        Allow the default hash key to be used beyond tests.
                        INADVISABLE!
  --rounding_sf ROUNDING_SF
                        Number of significant figures to use when rounding
                        frequencies in hashed version

frequency information for prior probabilities:
  --forename_sex_freq_csv FORENAME_SEX_FREQ_CSV
                        CSV file of "name, sex, frequency" pairs for
                        forenames. You can generate one via
                        crate_fetch_wordlists.
  --forename_cache_filename FORENAME_CACHE_FILENAME
                        File in which to store cached forename info (to speed
                        loading)
  --surname_freq_csv SURNAME_FREQ_CSV
                        CSV file of "name, frequency" pairs for forenames. You
                        can generate one via crate_fetch_wordlists.
  --surname_cache_filename SURNAME_CACHE_FILENAME
                        File in which to store cached surname info (to speed
                        loading)
  --name_min_frequency NAME_MIN_FREQUENCY
                        Minimum base frequency for names. If a frequency is
                        less than this, use this minimum. Allowing extremely
                        low frequencies may increase the chances of a spurious
                        match. Note also that typical name frequency tables
                        don't give very-low-frequency information. For
                        example, for US census forename/surname information,
                        below 0.001 percent they report 0.000 percent; so a
                        reasonable minimum is 0.0005 percent or 0.000005 or
                        5e-6.
  --p_middle_name_n_present P_MIDDLE_NAME_N_PRESENT
                        CSV list of probabilities that a randomly selected
                        person has a certain number of middle names. The first
                        number is P(has a first middle name). The second
                        number is P(has a second middle name | has a first
                        middle name), and so on. The last number present will
                        be re-used ad infinitum if someone has more names.
  --population_size POPULATION_SIZE
                        Size of the whole population, from which we calculate
                        the baseline log odds that two people, randomly
                        selected (and replaced) from the population are the
                        same person.
  --birth_year_pseudo_range BIRTH_YEAR_PSEUDO_RANGE
                        Birth year pseudo-range. The sole purpose is to
                        calculate the probability of two random people sharing
                        a DOB, which is taken as 1/(365.25 * b). This option
                        is b.
  --postcode_csv_filename POSTCODE_CSV_FILENAME
                        CSV file of postcode geography from UK Census/ONS
                        data. A ZIP file is also acceptable.
  --postcode_cache_filename POSTCODE_CACHE_FILENAME
                        File in which to store cached postcodes (to speed
                        loading)
  --mean_oa_population MEAN_OA_POPULATION
                        Mean population of a UK Census Output Area, from which
                        we estimate the population of postcode-based units.
  --p_not_male_or_female P_NOT_MALE_OR_FEMALE
                        Probability that a person in the population has gender
                        'X'.
  --p_female_given_male_or_female P_FEMALE_GIVEN_MALE_OR_FEMALE
                        Probability that a person in the population is female,
                        given that they are either male or female.

error probabilities:
  --p_minor_forename_error P_MINOR_FORENAME_ERROR
                        Assumed probability that a forename has an error in
                        that means it fails a full match but satisfies a
                        partial (metaphone) match.
  --p_minor_surname_error P_MINOR_SURNAME_ERROR
                        Assumed probability that a surname has an error in
                        that means it fails a full match but satisfies a
                        partial (metaphone) match.
  --p_proband_middle_name_missing P_PROBAND_MIDDLE_NAME_MISSING
                        Probability that a middle name, present in the sample,
                        is missing from the proband.
  --p_sample_middle_name_missing P_SAMPLE_MIDDLE_NAME_MISSING
                        Probability that a middle name, present in the
                        proband, is missing from the sample.
  --p_minor_postcode_error P_MINOR_POSTCODE_ERROR
                        Assumed probability that a postcode has an error in
                        that means it fails a full (postcode unit) match but
                        satisfies a partial (postcode sector) match.
  --p_gender_error P_GENDER_ERROR
                        Assumed probability that a gender is wrong leading to
                        a proband/candidate mismatch.

matching rules:
  --min_log_odds_for_match MIN_LOG_ODDS_FOR_MATCH
                        Minimum natural log (ln) odds of two people being the
                        same, before a match will be considered. (Default is
                        equivalent to p = 0.999.)
  --exceeds_next_best_log_odds EXCEEDS_NEXT_BEST_LOG_ODDS
                        Minimum log (ln) odds by which a best match must
                        exceed the next-best match to be considered a unique
                        match.

===============================================================================
Help for command 'show_dob_freq'
===============================================================================
usage: crate_fuzzy_id_match show_dob_freq [-h] [--verbose] [--key KEY]
                                          [--allow_default_hash_key]
                                          [--rounding_sf ROUNDING_SF]
                                          [--forename_sex_freq_csv FORENAME_SEX_FREQ_CSV]
                                          [--forename_cache_filename FORENAME_CACHE_FILENAME]
                                          [--surname_freq_csv SURNAME_FREQ_CSV]
                                          [--surname_cache_filename SURNAME_CACHE_FILENAME]
                                          [--name_min_frequency NAME_MIN_FREQUENCY]
                                          [--p_middle_name_n_present P_MIDDLE_NAME_N_PRESENT]
                                          [--population_size POPULATION_SIZE]
                                          [--birth_year_pseudo_range BIRTH_YEAR_PSEUDO_RANGE]
                                          [--postcode_csv_filename POSTCODE_CSV_FILENAME]
                                          [--postcode_cache_filename POSTCODE_CACHE_FILENAME]
                                          [--mean_oa_population MEAN_OA_POPULATION]
                                          [--p_not_male_or_female P_NOT_MALE_OR_FEMALE]
                                          [--p_female_given_male_or_female P_FEMALE_GIVEN_MALE_OR_FEMALE]
                                          [--p_minor_forename_error P_MINOR_FORENAME_ERROR]
                                          [--p_minor_surname_error P_MINOR_SURNAME_ERROR]
                                          [--p_proband_middle_name_missing P_PROBAND_MIDDLE_NAME_MISSING]
                                          [--p_sample_middle_name_missing P_SAMPLE_MIDDLE_NAME_MISSING]
                                          [--p_minor_postcode_error P_MINOR_POSTCODE_ERROR]
                                          [--p_gender_error P_GENDER_ERROR]
                                          [--min_log_odds_for_match MIN_LOG_ODDS_FOR_MATCH]
                                          [--exceeds_next_best_log_odds EXCEEDS_NEXT_BEST_LOG_ODDS]

optional arguments:
  -h, --help            show this help message and exit

display options:
  --verbose             Be verbose

hasher (secrecy) options:
  --key KEY             Key (passphrase) for hasher
  --allow_default_hash_key
                        Allow the default hash key to be used beyond tests.
                        INADVISABLE!
  --rounding_sf ROUNDING_SF
                        Number of significant figures to use when rounding
                        frequencies in hashed version

frequency information for prior probabilities:
  --forename_sex_freq_csv FORENAME_SEX_FREQ_CSV
                        CSV file of "name, sex, frequency" pairs for
                        forenames. You can generate one via
                        crate_fetch_wordlists.
  --forename_cache_filename FORENAME_CACHE_FILENAME
                        File in which to store cached forename info (to speed
                        loading)
  --surname_freq_csv SURNAME_FREQ_CSV
                        CSV file of "name, frequency" pairs for forenames. You
                        can generate one via crate_fetch_wordlists.
  --surname_cache_filename SURNAME_CACHE_FILENAME
                        File in which to store cached surname info (to speed
                        loading)
  --name_min_frequency NAME_MIN_FREQUENCY
                        Minimum base frequency for names. If a frequency is
                        less than this, use this minimum. Allowing extremely
                        low frequencies may increase the chances of a spurious
                        match. Note also that typical name frequency tables
                        don't give very-low-frequency information. For
                        example, for US census forename/surname information,
                        below 0.001 percent they report 0.000 percent; so a
                        reasonable minimum is 0.0005 percent or 0.000005 or
                        5e-6.
  --p_middle_name_n_present P_MIDDLE_NAME_N_PRESENT
                        CSV list of probabilities that a randomly selected
                        person has a certain number of middle names. The first
                        number is P(has a first middle name). The second
                        number is P(has a second middle name | has a first
                        middle name), and so on. The last number present will
                        be re-used ad infinitum if someone has more names.
  --population_size POPULATION_SIZE
                        Size of the whole population, from which we calculate
                        the baseline log odds that two people, randomly
                        selected (and replaced) from the population are the
                        same person.
  --birth_year_pseudo_range BIRTH_YEAR_PSEUDO_RANGE
                        Birth year pseudo-range. The sole purpose is to
                        calculate the probability of two random people sharing
                        a DOB, which is taken as 1/(365.25 * b). This option
                        is b.
  --postcode_csv_filename POSTCODE_CSV_FILENAME
                        CSV file of postcode geography from UK Census/ONS
                        data. A ZIP file is also acceptable.
  --postcode_cache_filename POSTCODE_CACHE_FILENAME
                        File in which to store cached postcodes (to speed
                        loading)
  --mean_oa_population MEAN_OA_POPULATION
                        Mean population of a UK Census Output Area, from which
                        we estimate the population of postcode-based units.
  --p_not_male_or_female P_NOT_MALE_OR_FEMALE
                        Probability that a person in the population has gender
                        'X'.
  --p_female_given_male_or_female P_FEMALE_GIVEN_MALE_OR_FEMALE
                        Probability that a person in the population is female,
                        given that they are either male or female.

error probabilities:
  --p_minor_forename_error P_MINOR_FORENAME_ERROR
                        Assumed probability that a forename has an error in
                        that means it fails a full match but satisfies a
                        partial (metaphone) match.
  --p_minor_surname_error P_MINOR_SURNAME_ERROR
                        Assumed probability that a surname has an error in
                        that means it fails a full match but satisfies a
                        partial (metaphone) match.
  --p_proband_middle_name_missing P_PROBAND_MIDDLE_NAME_MISSING
                        Probability that a middle name, present in the sample,
                        is missing from the proband.
  --p_sample_middle_name_missing P_SAMPLE_MIDDLE_NAME_MISSING
                        Probability that a middle name, present in the
                        proband, is missing from the sample.
  --p_minor_postcode_error P_MINOR_POSTCODE_ERROR
                        Assumed probability that a postcode has an error in
                        that means it fails a full (postcode unit) match but
                        satisfies a partial (postcode sector) match.
  --p_gender_error P_GENDER_ERROR
                        Assumed probability that a gender is wrong leading to
                        a proband/candidate mismatch.

matching rules:
  --min_log_odds_for_match MIN_LOG_ODDS_FOR_MATCH
                        Minimum natural log (ln) odds of two people being the
                        same, before a match will be considered. (Default is
                        equivalent to p = 0.999.)
  --exceeds_next_best_log_odds EXCEEDS_NEXT_BEST_LOG_ODDS
                        Minimum log (ln) odds by which a best match must
                        exceed the next-best match to be considered a unique
                        match.

